<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>PDF変換アプリ</title>
    <base href="/" />

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">

    <link href="css/app.css" rel="stylesheet" />
    <link rel="icon" type="image/png" href="favicon.png" />
    <!--<link href="PdfConverterApp.styles.css" rel="stylesheet" />-->
</head>

<body>
    <div id="app">
        <div class="d-flex justify-content-center align-items-center vh-100">
            <div class="text-center">
                <div class="spinner-border text-primary mb-3" role="status" style="width: 3rem; height: 3rem;">
                    <span class="visually-hidden">読み込み中...</span>
                </div>
                <h5 class="text-muted">アプリケーションを読み込んでいます...</h5>
            </div>
        </div>
    </div>

    <div id="blazor-error-ui">
        <div class="alert alert-danger m-3" role="alert">
            <i class="bi bi-exclamation-triangle"></i>
            予期しないエラーが発生しました。
            <a href="" class="reload btn btn-outline-danger btn-sm ms-2">再読み込み</a>
            <a class="dismiss btn-close" aria-label="Close"></a>
        </div>
    </div>

    <!-- ファイルダウンロード用JavaScript -->
    <script>
        /**
         * Base64データからファイルをダウンロード
         */
        window.downloadFileFromBase64 = (base64Data, fileName, contentType) => {
            try {
                console.log(`ダウンロード開始: ${fileName}`);

                // Base64をバイナリに変換
                const byteCharacters = atob(base64Data);
                const byteNumbers = new Array(byteCharacters.length);

                for (let i = 0; i < byteCharacters.length; i++) {
                    byteNumbers[i] = byteCharacters.charCodeAt(i);
                }

                const byteArray = new Uint8Array(byteNumbers);
                const blob = new Blob([byteArray], { type: contentType });

                // ダウンロード実行
                const url = window.URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                link.download = fileName;

                // DOM操作でクリック実行
                document.body.appendChild(link);
                link.click();

                // リソースクリーンアップ
                setTimeout(() => {
                    document.body.removeChild(link);
                    window.URL.revokeObjectURL(url);
                }, 100);

                console.log(`ダウンロード完了: ${fileName}`);
            } catch (error) {
                console.error('ダウンロードエラー:', error);
                alert(`ファイルのダウンロードに失敗しました: ${error.message}`);
            }
        };

        // エラーUI制御
        document.addEventListener('DOMContentLoaded', function () {
            const errorUI = document.getElementById('blazor-error-ui');
            if (errorUI) {
                const dismissButton = errorUI.querySelector('.dismiss');
                if (dismissButton) {
                    dismissButton.addEventListener('click', function () {
                        errorUI.style.display = 'none';
                    });
                }
            }
        });
    </script>

    <script src="_framework/blazor.webassembly.js"></script>
    <script>navigator.serviceWorker.register('service-worker.js');</script>
</body>

</html>
